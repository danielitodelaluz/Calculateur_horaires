<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Calculateur d'Horaires</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 600px;
    }
    h1, h3 {
      color: #333;
    }
    .day-row {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 5px;
    }
    .slider-container {
      margin: 5px 0;
    }
    .slider-label {
      display: inline-block;
      width: 80px;
    }
    #result {
      margin-top: 20px;
      color: blue;
    }
  </style>
</head>
<body>
  <h1>Calculateur d'Horaires</h1>
  
  <div>
    <label for="jours_travailles">
      Nombre de jours déjà travaillés (0 à 5) :
    </label>
    <input type="number" id="jours_travailles" value="0" min="0" max="5">
  </div>
  
  <!-- Conteneur des jours travaillés -->
  <div id="workedDays"></div>
  
  <button onclick="calculerHoraires()">Calculer</button>
  
  <div id="result"></div>
  
  <script>
    // Définition des noms de jours
    const dayNames = ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi"];

    // Convertit des minutes en format "HH:MM"
    function minutesToTime(m) {
      let hours = Math.floor(m / 60);
      let minutes = m % 60;
      return ("0" + hours).slice(-2) + ":" + ("0" + minutes).slice(-2);
    }

    // Calcule le total d'heures travaillées pour les jours déjà effectués
    // Chaque jour, si la durée (départ - arrivée) est d'au moins 6h, on retire 1h de pause
    function calculHeuresTravaillees(horaires) {
      let total = 0;
      horaires.forEach(jour => {
        let diff = (jour.depart - jour.arrivee) / 60;
        if(diff >= 6) diff -= 1;
        total += diff;
      });
      return total;
    }

    // Répartit de façon concentrée les heures supplémentaires sur les jours restants pour atteindre 35h
    // Chaque jour a un créneau obligatoire de 09:00 à 15:00 (6h)
    function distributionMinimale(extra_total, nb_jours) {
      let suggestions = [];
      for (let i = 0; i < nb_jours; i++) {
        if (extra_total > 0) {
          let extra_for_day = Math.min(extra_total, 5); // max 5h d'extra par jour
          extra_total -= extra_for_day;
          let extra_matin = 0, extra_soir = 0;
          if (extra_for_day <= 3) {
            extra_soir = extra_for_day;
          } else {
            extra_soir = 3;
            extra_matin = extra_for_day - 3;
          }
          // "09:00" = 540 minutes, "15:00" = 900 minutes
          let arrival = 540 - extra_matin * 60;
          let departure = 900 + extra_soir * 60;
          suggestions.push({
            arrivee: minutesToTime(arrival),
            depart: minutesToTime(departure)
          });
        } else {
          suggestions.push({arrivee: "09:00", depart: "15:00"});
        }
      }
      return suggestions;
    }

    // Met à jour dynamiquement les champs de saisie pour les jours déjà travaillés
    function updateWorkedDays() {
      const nb = parseInt(document.getElementById("jours_travailles").value) || 0;
      const container = document.getElementById("workedDays");
      container.innerHTML = "";
      for (let i = 0; i < nb; i++) {
        let dayDiv = document.createElement("div");
        dayDiv.className = "day-row";
        dayDiv.innerHTML = `
          <h3>${dayNames[i]}</h3>
          <div class="slider-container">
            <label class="slider-label">Arrivée:</label>
            <input type="range" id="arrivee_${i}" min="420" max="540" step="5" value="540" 
              oninput="document.getElementById('arr_label_${i}').innerText = minutesToTime(parseInt(this.value))">
            <span id="arr_label_${i}">${minutesToTime(540)}</span>
          </div>
          <div class="slider-container">
            <label class="slider-label">Départ:</label>
            <input type="range" id="depart_${i}" min="900" max="1080" step="5" value="900" 
              oninput="document.getElementById('dep_label_${i}').innerText = minutesToTime(parseInt(this.value))">
            <span id="dep_label_${i}">${minutesToTime(900)}</span>
          </div>
        `;
        container.appendChild(dayDiv);
      }
    }

    // Calcule et affiche les horaires en fonction des jours travaillés et des suggestions pour les jours restants
    function calculerHoraires() {
      const joursTravailles = parseInt(document.getElementById("jours_travailles").value);
      if (isNaN(joursTravailles)) {
        alert("Veuillez entrer un nombre valide pour le nombre de jours déjà travaillés.");
        return;
      }
      let horaires = [];
      for (let i = 0; i < joursTravailles; i++) {
        let arrivee = parseInt(document.getElementById("arrivee_" + i).value);
        let depart = parseInt(document.getElementById("depart_" + i).value);
        horaires.push({jour: dayNames[i], arrivee: arrivee, depart: depart});
      }
      let heuresTravaillees = calculHeuresTravaillees(horaires);
      const total_jours = 5;
      const jours_restants = total_jours - joursTravailles;
      const heures_mandatoires_restantes = jours_restants * 6;
      const total_sans_extra = heuresTravaillees + heures_mandatoires_restantes;
      const extra_total = Math.max(0, 35 - total_sans_extra);
      const suggestions = distributionMinimale(extra_total, jours_restants);
      const total_restant = 35 - heuresTravaillees;
      
      let result = "Il vous reste " + total_restant.toFixed(2) + " heures à travailler sur les jours restants (en comptant 6h obligatoires par jour).<br><br>";
      result += "Suggestions pour les jours restants :<br>";
      for (let i = 0; i < suggestions.length; i++) {
        let jour;
        if (joursTravailles + i < dayNames.length) {
          jour = dayNames[joursTravailles + i];
        } else {
          jour = "Jour " + (joursTravailles + i + 1);
        }
        result += jour + " -> Arrivée : " + suggestions[i].arrivee + ", Départ : " + suggestions[i].depart + "<br>";
      }
      document.getElementById("result").innerHTML = result;
    }

    // Écoute le changement du nombre de jours travaillés pour mettre à jour l'interface
    document.getElementById("jours_travailles").addEventListener("change", updateWorkedDays);

    // Initialisation au chargement de la page
    updateWorkedDays();
  </script>
</body>
</html>
